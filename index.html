<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="assets/styles/style.css" />
    <link rel="icon" href="assets/images/tkc.png" type="image/png" />
    <title>Codex Helper</title>
  </head>
  <body class="body-main">
    <nav class="navbar">
      <a href="./">
        <img
          src="assets/images/logo.gif"
          alt="The King's Codex"
          class="navbar-logo"
        />
      </a>
      <input type="checkbox" id="nav-toggle" class="nav-toggle" />
      <label for="nav-toggle" class="nav-toggle-label">
        <span></span>
        <span></span>
        <span></span>
      </label>
      <div class="navbar-links">
        <ul>
          <li><a href="#home" class="navbar-link">Home</a></li>
          <li><a href="pages/features.html" class="navbar-link">Features</a></li>
          <li><a href="#commands" class="navbar-link">Commands</a></li>
          <li>
            <a
              href="https://www.patreon.com/kingscodex"
              target="_blank"
              class="navbar-link"
              >Patreon</a
            >
          </li>
          <li class="cta-buttons">
            <a
              href="https://discord.gg/kingscodex"
              target="_blank"
              class="btn btn-discord"
            >
              <i class="fab fa-discord"></i> Support Server
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <header id="home" class="hero-section">
      <div class="hero-title">
        <div class="hero-title-logo">
          <img
            src="assets/images/KingsCodex_Logo_NoURL-NoGlow.png"
            alt="logo"
            class="hero-logo"
          />
          <h1>Codex <span>Helper Bot</span></h1>
        </div>
        <p class="hero-subtitle">
            Your ultimate Rise of Kingdoms companion. All the strategies, data, and tools you need, right in your Discord server.
        </p>
        <div class="hero-btns">
          <a
            href="https://discord.gg/kingscodex"
            target="_blank"
            class="btn btn-primary-hero"
          >
            Our Discord
          </a>
          <a
            href="https://www.patreon.com/kingscodex"
            target="_blank"
            class="btn btn-secondary-hero"
          >
            Invite Now
            <img
              src="assets/images/new-tab.png"
              alt="new tab icon"
              class="new-tab-icon"
          /></a>
        </div>
      </div>
      <img
        src="assets/images/mulan.png"
        alt="The King's Codex Banner"
        class="hero-banner"
      />
    </header>

    <section id="trusted-by" class="content-section">
        <h2>Trusted by the best</h2>
        <p>Codex Helper is trusted by some of the largest and most active Rise of Kingdoms communities on Discord.</p>
        
        <div class="server-list-container">
            <ul class="server-list" data-animated="true">
                <p class="loading-message">Loading top servers...</p>
            </ul>
        </div>
    </section>

    <section id="commands" class="content-section">
      <h2>Commands</h2>
      <p>Here's a list of what I can do!</p>
      <p>
        All commands are slash commands (e.g., /codex). If you need more
        detailed help, want to provide feedback, or require support, please use
        the button at the bottom of this message.
      </p>
      <ul>
        <div class="commands-container">
          <img
            src="assets/images/admin-command.png"
            alt="admin commands icon"
            class="commands-icon"
          />
          <p>Admin Commands</p>
        </div>
        <li>/channel → Set allowed channels for different command groups.</li>
        <li>
          /config → See your current allowed channel settings & information
          about the bot.
        </li>
      </ul>
      <ul>
        <div class="commands-container">
          <img
            src="assets/images/general-command.png"
            alt="general commands icon"
            class="commands-icon"
          />
          <p>General Commands</p>
        </div>
        <li>/bundle → Information & summary of contents for common bundles.</li>
        <li>/commander → Recommended setup for every commander in the game.</li>
        <li>/event → Guides & information for commonly rotating events.</li>
        <li>
          /pairings → Meta pairings for most scenarios within ROK by King's
          Codex scholars.
        </li>
      </ul>
      <ul>
        <div class="commands-container">
          <img
            src="assets/images/kvk-command.png"
            alt="kingdom versus kingdom commands icon"
            class="commands-icon"
          />
          <p>KvK Commands</p>
        </div>
        <li>
          /flag → Calculate the current/projected amount of flags you're able to
          place in KvK.
        </li>
        <li>
          /timer → Calculate different timers, like structure timings & kingdom
          buffs.
        </li>
      </ul>
    </section>

    <section class="content-section">
      <p>
        If you have any questions, please visit our
        <a href="https://discord.gg/kingscodex">Discord Support Server</a>.
      </p>
    </section>

    <footer class="footer">
      <ul>
        <li><a href="pages/privacy.html">Privacy Policy</a></li>
        <li><a href="pages/terms.html">Terms of Service</a></li>
      </ul>
      <p>© 2025 The King's Codex. All rights reserved.</p>
    </footer>

    <script src="scripts/main.js"></script>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const serverList = document.querySelector('.server-list');
        // Use your new, secure, and professional API URL
        const apiUrl = 'https://api.codexhelper.com/api/top-servers';
    
        fetch(apiUrl) // No more proxy needed!
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Network response was not ok (status: ${response.status})`);
                }
                return response.json();
            })
            .then(servers => {
                serverList.innerHTML = '';
    
                if (!servers || servers.length === 0) {
                    serverList.innerHTML = '<p class="error-message">Could not load server data at this time.</p>';
                    return;
                }
    
                servers.forEach(server => {
                    const serverItem = document.createElement('li');
                    serverItem.className = 'server-item';
    
                    const memberCount = server.member_count.toLocaleString();
    
                    const iconHtml = server.icon_url 
                        ? `<img src="${server.icon_url}" alt="${server.name} Icon" class="server-logo">`
                        : `<div class="server-logo-placeholder"></div>`;
    
                    serverItem.innerHTML = `
                        ${iconHtml}
                        <div class="server-info">
                            <p class="server-name">${server.name}</p>
                            <span class="server-members">
                                <svg width="10" height="10" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="6" cy="6" r="6" fill="#43b581"></circle></svg>
                                ${memberCount} members
                            </span>
                        </div>
                    `;
                    serverList.appendChild(serverItem);
                });
    
                const scrollerContent = Array.from(serverList.children);
                scrollerContent.forEach(item => {
                    const duplicatedItem = item.cloneNode(true);
                    duplicatedItem.setAttribute('aria-hidden', true);
                    serverList.appendChild(duplicatedItem);
                });
            })
            .catch(error => {
                console.error('Error fetching top servers:', error);
                serverList.innerHTML = '<p class="error-message">Could not retrieve server data. Please try again later.</p>';
            });
    });
    </script>
  </body>
</html>
