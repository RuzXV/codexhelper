<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="assets/styles/style.css" />
    <link rel="icon" href="assets/images/tkc.png" type="image/png" />
    <title>Codex Helper Policies</title>
  </head>
  <body class="body-main">
    <nav class="navbar">
      <a href="./">
        <img
          src="assets/images/logo.gif"
          alt="The King's Codex"
          class="navbar-logo"
        />
      </a>
      <input type="checkbox" id="nav-toggle" class="nav-toggle" />
      <label for="nav-toggle" class="nav-toggle-label">
        <span></span>
        <span></span>
        <span></span>
      </label>
      <div class="navbar-links">
        <ul>
          <li><a href="#home" class="navbar-link">Home</a></li>
          <li><a href="features.html" class="navbar-link">Features</a></li>
          <li><a href="#commands" class="navbar-link">Commands</a></li>
          <li>
            <a
              href="https://www.patreon.com/kingscodex"
              target="_blank"
              class="navbar-link"
              >Patreon</a
            >
          </li>
          <li class="cta-buttons">
            <a
              href="https://discord.gg/kingscodex"
              target="_blank"
              class="btn btn-discord"
            >
              <i class="fab fa-discord"></i> Support Server
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <header id="home" class="hero-section">
      <div class="hero-title">
        <div class="hero-title-logo">
          <img
            src="assets/images/KingsCodex_Logo_NoURL-NoGlow.png"
            alt="logo"
            class="hero-logo"
          />
          <h1>Codex <span>Helper Bot</span></h1>
        </div>
        <p class="hero-subtitle">
            Your ultimate Rise of Kingdoms companion. All the strategies, data, and tools you need, right in your Discord server.
        </p>
        <div class="hero-btns">
          <a
            href="https://discord.gg/kingscodex"
            target="_blank"
            class="btn btn-primary-hero"
          >
            Our Discord
          </a>
          <a
            href="https://www.patreon.com/kingscodex"
            target="_blank"
            class="btn btn-secondary-hero"
          >
            Invite Now
            <img
              src="assets/images/new-tab.png"
              alt="new tab icon"
              class="new-tab-icon"
          /></a>
        </div>
      </div>
      <img
        src="assets/images/mulan.png"
        alt="The King's Codex Banner"
        class="hero-banner"
      />
    </header>

    <section id="trusted-by" class="content-section">
        <h2>Trusted by the best</h2>
        <p>Codex Helper is trusted by some of the largest and most active Rise of Kingdoms communities on Discord.</p>
        
        <!-- This div will be populated by the JavaScript below -->
        <div class="server-list">
            <!-- It's good practice to have a loading message as a placeholder -->
            <p>Loading top servers...</p>
        </div>
    </section>

    <section id="commands" class="content-section">
      <h2>Commands</h2>
      <p>Here's a list of what I can do!</p>
      <p>
        All commands are slash commands (e.g., /codex). If you need more
        detailed help, want to provide feedback, or require support, please use
        the button at the bottom of this message.
      </p>
      <ul>
        <div class="commands-container">
          <img
            src="assets/images/admin-command.png"
            alt="admin commands icon"
            class="commands-icon"
          />
          <p>Admin Commands</p>
        </div>
        <li>/channel → Set allowed channels for different command groups.</li>
        <li>
          /config → See your current allowed channel settings & information
          about the bot.
        </li>
      </ul>
      <ul>
        <div class="commands-container">
          <img
            src="assets/images/general-command.png"
            alt="general commands icon"
            class="commands-icon"
          />
          <p>General Commands</p>
        </div>
        <li>/bundle → Information & summary of contents for common bundles.</li>
        <li>/commander → Recommended setup for every commander in the game.</li>
        <li>/event → Guides & information for commonly rotating events.</li>
        <li>
          /pairings → Meta pairings for most scenarios within ROK by King's
          Codex scholars.
        </li>
      </ul>
      <ul>
        <div class="commands-container">
          <img
            src="assets/images/kvk-command.png"
            alt="kingdom versus kingdom commands icon"
            class="commands-icon"
          />
          <p>KvK Commands</p>
        </div>
        <li>
          /flag → Calculate the current/projected amount of flags you're able to
          place in KvK.
        </li>
        <li>
          /timer → Calculate different timers, like structure timings & kingdom
          buffs.
        </li>
      </ul>
    </section>

    <section class="content-section">
      <p>
        If you have any questions, please visit our
        <a href="https://discord.gg/kingscodex">Discord Support Server</a>.
      </p>
    </section>

    <footer class="footer">
      <ul>
        <li><a href="pages/privacy.html">Privacy Policy</a></li>
        <li><a href="pages/terms.html">Terms of Service</a></li>
      </ul>
      <p>© 2025 The King's Codex. All rights reserved.</p>
    </footer>

    <script src="scripts/main.js"></script>
    
    <!-- SCRIPT TO FETCH AND DISPLAY TOP SERVERS -->
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // The container where the server list will be displayed.
        const serverListContainer = document.querySelector('.server-list');
    
        // Your working API endpoint URL.
        const apiUrl = 'http://193.31.31.121:25829/api/top-servers';
    
        // Use the fetch API to get the data from your bot.
        fetch(apiUrl)
            .then(response => {
                // Check if the request was successful.
                if (!response.ok) {
                    throw new Error(`Network response was not ok (status: ${response.status})`);
                }
                return response.json(); // Parse the JSON from the response.
            })
            .then(servers => {
                // Clear the "Loading..." placeholder text.
                serverListContainer.innerHTML = '';
    
                // If the API returns an empty list, show a friendly message.
                if (!servers || servers.length === 0) {
                    serverListContainer.innerHTML = '<p>Could not load server data at this time.</p>';
                    return;
                }
    
                // Loop through each server object returned by the API.
                servers.forEach(server => {
                    // Create a new div element for this server item.
                    const serverItem = document.createElement('div');
                    serverItem.className = 'server-item';
    
                    // Format the member count with commas (e.g., 100,000).
                    const memberCount = server.member_count.toLocaleString();
    
                    // Check if the server has an icon_url. If not, use the placeholder.
                    const iconHtml = server.icon_url 
                        ? `<img src="${server.icon_url}" alt="${server.name} Icon" class="server-logo">`
                        : '<div class="server-logo-placeholder"></div>';
    
                    // Set the complete HTML content for the server item.
                    serverItem.innerHTML = `
                        ${iconHtml}
                        <p>${server.name}</p>
                        <span>${memberCount} members</span>
                    `;
    
                    // Add the newly created server item to the main container.
                    serverListContainer.appendChild(serverItem);
                });
            })
            .catch(error => {
                // If anything goes wrong with the fetch request, log it and show an error.
                console.error('Error fetching top servers:', error);
                serverListContainer.innerHTML = '<p>Could not retrieve server data. Please try again later.</p>';
            });
    });
    </script>
  </body>
</html>
