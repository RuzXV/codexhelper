.tool-hero { transition: all 0.5s ease-out; }

.calculator-main-title { display: flex; align-items: center; justify-content: center; gap: var(--spacing-4); }
.calculator-main-title img { height: 40px; }

.quick-access-container { display: flex; justify-content: center; margin-bottom: var(--spacing-8); }
.quick-access-nav { display: flex; justify-content: center; gap: var(--spacing-3); flex-wrap: nowrap; background: rgba(20, 21, 24, 0.65); padding: var(--spacing-2); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: var(--radius-md); }
.quick-access-btn { background: var(--bg-secondary); border: 1px solid var(--border-color); padding: var(--spacing-2) var(--spacing-3); border-radius: var(--radius-md); cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: var(--spacing-2); color: var(--text-primary); }
.quick-access-btn:hover { background: var(--bg-tertiary); border-color: var(--border-hover); }
.quick-access-btn.active { background: var(--accent-blue-light); border-color: var(--accent-blue); color: var(--text-primary); }
.quick-access-btn img { width: 24px; height: 24px; }
.quick-access-btn span { font-weight: 600; font-size: var(--font-size-sm); white-space: nowrap; }

.carousel-container { position: relative; width: 100%; margin: 0 auto; overflow: hidden; }
.carousel-track { 
    display: flex; 
    align-items: flex-start; 
    will-change: transform; 
    gap: 0 !important; 
    column-gap: 0 !important;
    margin: 0 !important;
}
.carousel-slide { flex: 0 0 600px; padding: 0 25px; box-sizing: border-box; transition: transform 0.5s cubic-bezier(0.25, 1, 0.5, 1), opacity 0.5s ease; transform: scale(0.8); opacity: 0.5; pointer-events: none; position: relative; }

.carousel-slide::before { content: ''; position: absolute; top: 0; left: 25px; width: calc(100% - 50px); height: 100%; background-color: rgba(20, 21, 24, 0.65); z-index: 2; opacity: 1; transition: opacity 0.5s ease; pointer-events: none; border-radius: var(--radius-lg); }

.carousel-slide.is-active { transform: scale(1); opacity: 1; pointer-events: auto; }

.carousel-slide.is-active::before { opacity: 0; transition: opacity 0.2s ease-out; }

.carousel-arrow { position: absolute; top: 35%; transform: translateY(-50%); background: transparent; border: none; color: rgba(255, 255, 255, 0.7); cursor: pointer; z-index: 10; font-size: 3rem; padding: var(--spacing-4); text-shadow: 0 0 10px rgba(0,0,0,0.5); transition: color 0.3s ease, opacity 0.3s ease; }
.carousel-arrow:hover { color: white; }
.carousel-arrow.disabled { opacity: 0.2; cursor: default; pointer-events: none; }
.carousel-arrow.prev { left: calc(50% - 360px); }
.carousel-arrow.next { right: calc(50% - 360px); }

.calculator-island { background: rgba(20, 21, 24, 0.65); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: var(--radius-lg); padding: var(--spacing-6); width: 100%; max-width: 550px; margin: 0 auto; min-height: 550px; }

.island-content .form-group,
.island-content .form-group-horizontal,
.island-content .form-group-horizontal-power,
.island-content .form-group-toggle { margin-bottom: var(--spacing-6); }

.island-content label { display: block; font-weight: 500; color: var(--text-secondary); margin-bottom: var(--spacing-2); }
.island-content input[type="text"],
.island-content input[type="number"],
.island-content input[type="date"] { width: 100%; background: var(--bg-primary); border: 1px solid var(--border-hover); border-radius: var(--radius-sm); padding: var(--spacing-3); color: var(--text-primary); font-size: var(--font-size-base); transition: border-color 0.2s ease, box-shadow 0.2s ease; }
.island-content input[type="number"]::-webkit-outer-spin-button,
.island-content input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
.island-content input[type="number"] { -moz-appearance: textfield; appearance: textfield; }
.island-content input[type="text"]:focus,
.island-content input[type="number"]:focus,
.island-content input[type="date"]:focus { outline: none; border-color: var(--accent-blue); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); }

input[type="date"]::-webkit-calendar-picker-indicator { display: none; -webkit-appearance: none; }

.island-content .btn-primary { width: 100%; margin-top: var(--spacing-2); }
.island-content .disclaimer { font-size: var(--font-size-xs); color: var(--text-secondary); margin-top: -10px; margin-bottom: var(--spacing-4); text-align: center; }

.label-with-toggle { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-2); }

.label-with-toggle > label { margin-bottom: 0; }

.hoh-link-group { flex-shrink: 0; display: flex; flex-direction: row; align-items: baseline; gap: 5px; margin-bottom: 0; }

.hoh-link-anchor { color: var(--accent-blue-bright); text-decoration: none; font-weight: 600; font-size: var(--font-size-sm); margin-top: 0; white-space: nowrap; }

.hoh-link-label-top { font-size: var(--font-size-sm); color: var(--text-primary); font-weight: 500; margin-bottom: 0; cursor: default; white-space: nowrap; }

.hoh-link-anchor img { height: 1.1em; width: auto; margin-left: 5px; vertical-align: text-bottom; }

.hoh-link-group .hoh-link-label-top,
.hoh-link-group .hoh-link-anchor { position: relative; top: -2px; }

.rarity-selector, .building-selector { display: grid; gap: var(--spacing-3); }
.rarity-selector { grid-template-columns: 1fr 1fr; }
.building-selector { grid-template-columns: repeat(3, 1fr); }
.rarity-selector label, .building-selector label { position: relative; cursor: pointer; }
.rarity-selector input, .building-selector input { position: absolute; opacity: 0; width: 0; height: 0; }
.rarity-btn, .building-btn { display: flex; align-items: center; justify-content: center; gap: var(--spacing-2); padding: var(--spacing-2); border-radius: var(--radius-md); border: 1px solid rgba(255, 255, 255, 0.15); background-color: var(--bg-tertiary); font-weight: 600; color: white; text-shadow: 0 1px 3px rgba(0, 0, 0, 0.7); position: relative; overflow: hidden; transition: all 0.2s ease-in-out; flex-direction: column; height: 100%; font-size: var(--font-size-xs); }
.rarity-btn::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: inherit; z-index: 0; opacity: 0; transition: opacity 0.3s ease; }
.rarity-btn.legendary::after { background-image: radial-gradient(circle, #f28d00 0%, #d55800 100%); }
.rarity-btn.epic::after { background-image: radial-gradient(circle, #ca62e6 0%, #8113a7 100%); }
.rarity-btn.elite::after { background-image: radial-gradient(circle, #00a2d4 0%, #006d97 100%); }
.rarity-btn.advanced::after { background-image: radial-gradient(circle, #00be21 0%, #046c04 100%); }
.rarity-selector label:hover .rarity-btn::after, .rarity-selector input:checked + .rarity-btn::after { opacity: 1; }
.building-selector input:checked + .building-btn { background-color: var(--accent-blue-light); border-color: var(--accent-blue); }
.building-selector label:hover .building-btn { border-color: rgba(255, 255, 255, 0.4); }
.rarity-btn img, .rarity-btn span, .building-btn span, .building-btn img { position: relative; z-index: 1; }
.rarity-btn img { height: 24px; width: 24px; filter: drop-shadow(0 0 2px black); }
.building-btn img { height: 32px; width: auto; }
.rarity-selector input:checked + .rarity-btn, .building-selector input:checked + .building-btn { border-color: rgba(255, 255, 255, 0.7); transform: scale(0.98); }

#currency-label-icon { height: 1.2em; vertical-align: -0.2em; margin-left: 8px; }
.form-group-toggle { display: flex; align-items: center; gap: var(--spacing-3); margin-top: 0; }
.toggle-label { font-weight: 500; color: var(--text-primary); cursor: pointer; user-select: none; }
.toggle-switch { position: relative; display: inline-block; width: 50px; height: 28px; flex-shrink: 0; }
.toggle-switch input { opacity: 0; width: 0; height: 0; }
.toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--bg-primary); border: 1px solid var(--border-hover); border-radius: 28px; transition: .4s; overflow: hidden; }

.toggle-slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: var(--text-secondary); border-radius: 50%; transition: .4s; z-index: 2; }

.toggle-slider::after { position: absolute; top: 50%; transform: translateY(-50%); font-size: 10px; font-weight: bold; transition: all 0.4s ease; z-index: 1; content: attr(data-off); right: 8px; color: var(--text-secondary); }

.toggle-switch input:checked + .toggle-slider { background-color: var(--accent-blue); border-color: var(--accent-blue); }
.toggle-switch input:checked + .toggle-slider:before { transform: translateX(22px); background-color: white; }

.toggle-switch input:checked + .toggle-slider::after { content: attr(data-on); left: 8px; right: auto; color: white; }

.toggle-switch input:disabled + .toggle-slider { cursor: not-allowed; background-color: var(--bg-secondary); }
.toggle-switch input:disabled + .toggle-slider:before { background-color: var(--border-hover); }
.toggle-switch input:focus-visible + .toggle-slider { box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.4); }

#hospital-tier-toggle + .toggle-slider { background-image: radial-gradient(circle, #ca62e6 0%, #8113a7 100%); background-color: transparent; border-color: rgba(255, 255, 255, 0.15); }

#hospital-tier-toggle + .toggle-slider::after { color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }

#hospital-tier-toggle:checked + .toggle-slider { background-image: radial-gradient(circle, #f28d00 0%, #d55800 100%); background-color: transparent; border-color: rgba(255, 255, 255, 0.7); }

.calc-result { margin-top: var(--spacing-4); padding: var(--spacing-4); background: var(--bg-secondary); border-radius: var(--radius-md); text-align: center; font-size: var(--font-size-lg); min-height: 60px; display: flex; align-items: center; justify-content: center; gap: var(--spacing-3); border: 1px solid transparent; line-height: 1.4; box-shadow: inset 0 2px 4px rgba(0,0,0,0.2); position: relative; }
.calc-result.result-success::after { content: ''; position: absolute; inset: 0; border-radius: inherit; border: 2px solid transparent; animation: glow-border 1.2s ease-out; }
@keyframes glow-border { 0% { border-color: transparent; box-shadow: 0 0 0 0 transparent; } 25% { border-color: var(--accent-green); box-shadow: 0 0 15px 0 var(--accent-green); } 100% { border-color: transparent; box-shadow: 0 0 15px 0 transparent; } }

.calc-result.error { color: #ef4444; }
.calc-result img { height: 32px; }
.calc-result i.fa-check-circle { font-size: 28px; color: var(--accent-green); }
#cost-result, #building-cost-result { margin-top: var(--spacing-3); font-size: var(--font-size-base); min-height: 110px; flex-direction: column; gap: var(--spacing-3); align-items: center; justify-content: center; }
#hoh-result { flex-direction: row; }
#exp-result { flex-direction: column; gap: var(--spacing-3); align-items: center; justify-content: center; }
#passport-power-breakdown { flex-direction: column; align-items: flex-start; gap: var(--spacing-2); font-size: var(--font-size-base); line-height: 1.6; }
#passport-needed-result { margin-top: var(--spacing-3); }

.cost-line { display: flex; align-items: center; justify-content: center; gap: var(--spacing-2); }
.cost-line img { height: 28px; width: auto; }
.calc-result span, .calc-result strong { transition: filter 0.4s ease-out, opacity 0.4s ease-out; }
.counting-blur { filter: blur(2px); opacity: 0.8; transform: translateZ(0); }
.calc-result strong { color: var(--accent-blue-bright); font-weight: 700; margin: 0 4px; text-shadow: 0 0 8px rgba(90, 160, 255, 0.5); }

.vip-token-grid-container, .exp-tome-grid-container { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out, margin-top 0.5s ease-in-out, margin-bottom 0.5s ease-in-out; }
.vip-token-grid-container.visible { max-height: 300px; margin: var(--spacing-4) 0; }
.exp-tome-grid-container.visible { max-height: 400px; margin: var(--spacing-4) 0; }
.vip-token-grid, .exp-tome-grid { display: grid; gap: var(--spacing-3); }

.vip-token-grid { grid-template-columns: repeat(4, 1fr); }
.vip-token-item { background: var(--bg-tertiary); border: 1px solid var(--border-hover); border-radius: var(--radius-md); padding: var(--spacing-2); position: relative; overflow: hidden; display: flex; flex-direction: column; align-items: center; gap: var(--spacing-2); }
.vip-token-item::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: inherit; z-index: 0; opacity: 0.2; }
.vip-token-item.legendary::after { background-image: radial-gradient(circle, #f28d00 0%, #d55800 100%); }
.vip-token-item.epic::after { background-image: radial-gradient(circle, #ca62e6 0%, #8113a7 100%); }
.vip-token-item.elite::after { background-image: radial-gradient(circle, #00a2d4 0%, #006d97 100%); }
.vip-token-item.advanced::after { background-image: radial-gradient(circle, #00be21 0%, #046c04 100%); }
.vip-token-item.common::after { background-image: radial-gradient(circle, #a1a7b7 0%, #4b5260 100%); }
.vip-token-item img { width: 28px; height: 28px; position: relative; z-index: 1; }
.vip-token-info { display: flex; flex-direction: column; align-items: center; width: 100%; gap: var(--spacing-1); position: relative; z-index: 1; }
.vip-token-info label { font-size: var(--font-size-xs); font-weight: 500; color: var(--text-secondary); margin: 0; }
.vip-token-item input { padding: var(--spacing-1); text-align: center; font-size: var(--font-size-sm); border-radius: var(--radius-sm); width: 100%; max-width: 80px; }

.exp-tome-grid { grid-template-columns: repeat(6, 1fr); }
.exp-tome-item { background: var(--bg-tertiary); border: 1px solid var(--border-hover); border-radius: var(--radius-md); padding: var(--spacing-2); position: relative; overflow: hidden; display: flex; flex-direction: column; align-items: center; gap: var(--spacing-2); }
.exp-tome-grid .exp-tome-item:nth-child(-n+2) { grid-column: span 3; }
.exp-tome-grid .exp-tome-item:nth-child(n+3):nth-child(-n+4) { grid-column: span 3; }
.exp-tome-grid .exp-tome-item:nth-child(n+5) { grid-column: span 2; }
.exp-tome-item::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: inherit; z-index: 0; opacity: 0.2; }
.exp-tome-item.legendary::after { background-image: radial-gradient(circle, #f28d00 0%, #d55800 100%); }
.exp-tome-item.epic::after { background-image: radial-gradient(circle, #ca62e6 0%, #8113a7 100%); }
.exp-tome-item.elite::after { background-image: radial-gradient(circle, #00a2d4 0%, #006d97 100%); }
.exp-tome-item.advanced::after { background-image: radial-gradient(circle, #00be21 0%, #046c04 100%); }
.exp-tome-item img { width: 28px; height: 28px; position: relative; z-index: 1; }
.exp-tome-info { display: flex; flex-direction: column; align-items: center; width: 100%; gap: var(--spacing-1); position: relative; z-index: 1; }
.exp-tome-info label { font-size: var(--font-size-xs); font-weight: 500; color: var(--text-secondary); margin: 0; }
.exp-tome-item input { padding: var(--spacing-1); text-align: center; font-size: var(--font-size-sm); border-radius: var(--radius-sm); width: 100%; max-width: 100px; }

.hoh-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--spacing-3); position: relative; padding: var(--spacing-3); border-radius: var(--radius-lg); }
.hoh-grid::after { content: ''; position: absolute; inset: 0; border-radius: inherit; z-index: 0; opacity: 0.35; pointer-events: none; }
.hoh-grid.t5-group::after { background-image: radial-gradient(circle, #f28d00 0%, #d55800 100%); }
.hoh-grid.t4-group::after { background-image: radial-gradient(circle, #ca62e6 0%, #8113a7 100%); }
.hoh-item { background: var(--bg-tertiary); border: 1px solid var(--border-hover); border-radius: var(--radius-md); padding: var(--spacing-2); display: flex; flex-direction: column; align-items: center; gap: var(--spacing-2); position: relative; z-index: 1; }
.hoh-item img { width: 32px; height: 32px; object-fit: contain; }
.hoh-item label { font-size: var(--font-size-xs); font-weight: 500; color: var(--text-secondary); margin: 0; }
.hoh-item input { padding: var(--spacing-1); text-align: center; font-size: var(--font-size-sm); border-radius: var(--radius-sm); width: 100%; max-width: 100px; }
.hoh-return-selector { display: grid; grid-template-columns: repeat(5, 1fr); gap: var(--spacing-3); }
.hoh-return-selector label { position: relative; cursor: pointer; }
.hoh-return-selector input { position: absolute; opacity: 0; width: 0; height: 0; }
.hoh-return-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: var(--spacing-1); padding: var(--spacing-2); border-radius: var(--radius-md); border: 1px solid rgba(255, 255, 255, 0.15); background-color: var(--bg-tertiary); font-weight: 600; color: var(--text-primary); transition: all 0.2s ease-in-out; height: 100%; }
.hoh-return-sublabel { font-size: 11px; font-weight: 400; color: var(--text-secondary); }
.hoh-return-selector input:checked + .hoh-return-btn { background-color: var(--accent-blue-light); border-color: var(--accent-blue); }

.date-input-container { display: flex; align-items: stretch; gap: var(--spacing-3); height: 48px; }

.calendar-icon-label { display: flex; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0; transition: all 0.2s ease; }

.calendar-icon-label img { width: 48px; height: 48px; object-fit: contain; opacity: 0.9; transition: all 0.2s ease; }

.calendar-icon-label:hover img { opacity: 1; transform: scale(1.1); }

.input-wrapper { flex-grow: 1; display: flex; background: var(--bg-primary); border: 1px solid var(--border-hover); border-radius: var(--radius-sm); transition: border-color 0.2s ease, box-shadow 0.2s ease; }

#migration-date { width: 100%; height: 100%; padding: 0 var(--spacing-3); border: none; background: transparent; color: var(--text-primary); font-size: var(--font-size-base); outline: none; box-sizing: border-box; }

.input-wrapper:has(input:focus) { border-color: var(--accent-blue); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); }

.hoh-link-group .toggle-switch { width: 40px; height: 22px; }

.hoh-link-group .toggle-switch .toggle-slider:before { height: 16px; width: 16px; bottom: 2px; }

.hoh-link-group .toggle-switch input:checked + .toggle-slider:before { transform: translateX(18px); }

.custom-select-container { position: relative; }
.select-selected { display: flex; align-items: center; gap: var(--spacing-3); background: var(--bg-primary); border: 1px solid var(--border-hover); border-radius: var(--radius-sm); padding: var(--spacing-3); color: var(--text-primary); font-size: var(--font-size-base); cursor: pointer; user-select: none; transition: border-color 0.2s ease, box-shadow 0.2s ease; }
.select-selected.select-arrow-active { border-color: var(--accent-blue); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); }
.select-selected img { width: 24px; height: 24px; }
.select-selected::after { content: ""; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E"); background-position: center; background-repeat: no-repeat; background-size: 1.5em 1.5em; width: 1.5em; height: 1.5em; margin-left: auto; transition: transform 0.3s ease; }
.select-selected.select-arrow-active::after { transform: rotate(180deg); }
.select-items { position: absolute; background-color: var(--bg-tertiary); top: calc(100% + 4px); left: 0; right: 0; z-index: 99; border: 1px solid var(--border-hover); border-radius: var(--radius-sm); max-height: 200px; overflow-y: auto; }
.select-hide { display: none; }
.select-items div { display: flex; align-items: center; gap: var(--spacing-3); color: var(--text-secondary); padding: var(--spacing-3); cursor: pointer; }
.select-items div:hover, .same-as-selected { background-color: var(--accent-blue-light); color: var(--text-primary); }
.select-items div img { width: 24px; height: 24px; }

@media (max-width: 1200px) {
    .carousel-arrow.prev { left: calc(50% - 380px); }
    .carousel-arrow.next { right: calc(50% - 380px); }
}

@media (max-width: 768px) {
    .carousel-track { align-items: flex-start; }
    .carousel-slide { flex: 0 0 100%; transform: none; opacity: 1; filter: none; padding: 0 var(--spacing-12); pointer-events: auto; }
    .carousel-arrow { display: block; top: 40%; font-size: 2rem; }
    .carousel-arrow.prev { left: 2px; }
    .carousel-arrow.next { right: 2px; }
    .calculator-island { min-height: auto; }
    .quick-access-nav { overflow-x: auto; justify-content: flex-start; }
    .exp-tome-grid {
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    }
    .exp-tome-grid .exp-tome-item:nth-child(n) { grid-column: auto; }
    .exp-tome-grid .exp-tome-item:last-child { grid-column: auto; }
    .form-group-toggle .toggle-label {
        font-size: var(--font-size-sm);
        white-space: nowrap;
    }
    .vip-token-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 480px) {
    .calculator-main-title { font-size: var(--font-size-2xl); line-height: 1.2; }
    .tool-hero p { font-size: var(--font-size-sm); line-height: 1.5; }
    .quick-access-btn span { display: none; }
    .exp-tome-grid {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: var(--spacing-3);
    }
    .exp-tome-grid .exp-tome-item:nth-child(-n+2) {
        grid-column: span 3;
    }
    .exp-tome-grid .exp-tome-item:nth-child(n+3):nth-child(-n+5) {
        grid-column: span 2;
    }
    .exp-tome-grid .exp-tome-item:nth-child(n+6) {
        grid-column: span 3;
    }
    .hoh-grid { grid-template-columns: repeat(2, 1fr); }
    .building-btn span {
        font-size: 11px;
        white-space: nowrap;
    }
    .building-btn {
        min-height: 65px;
    }
    
    #building-cost-result .cost-line span {
        font-size: var(--font-size-sm);
    }
    #passport-power-breakdown,
    #cost-result {
        font-size: var(--font-size-sm);
    }
    .hoh-return-selector {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: var(--spacing-2);
    }
    .hoh-return-selector label:nth-child(-n+2) {
        grid-column: span 3;
    }
    
    .hoh-return-selector label:nth-child(n+3) {
        grid-column: span 2;
    }
    
    .hoh-return-btn {
        padding: var(--spacing-2) var(--spacing-1);
    }
    
    .hoh-return-btn, .hoh-return-sublabel {
        font-size: 11px;
    }
}