@font-face {
    font-family: 'NotoSansHans';
    src: url('/fonts/NotoSansHans-Black.otf') format('opentype');
    font-weight: 700;
    font-style: normal;
    font-display: swap;
}

.calculator-main-title { 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    gap: var(--spacing-3); 
    transform: none;
    transition: none;
}
.davor-title-icon {
    height: 60px;
    width: auto;
    filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.7));
    vertical-align: middle;
    margin-left: var(--spacing-2);
}

.quick-access-container { display: flex; justify-content: center; margin-bottom: var(--spacing-4); }
.quick-access-nav { display: flex; justify-content: center; gap: var(--spacing-3); flex-wrap: nowrap; background: rgba(20, 21, 24, 0.65); padding: var(--spacing-2); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: var(--radius-md); }
.quick-access-btn { background: var(--bg-secondary); border: 1px solid var(--border-color); padding: var(--spacing-2) var(--spacing-3); border-radius: var(--radius-md); cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: var(--spacing-2); color: var(--text-primary); }
.quick-access-btn:hover { background: var(--bg-tertiary); border-color: var(--border-hover); }
.quick-access-btn.active { background: var(--accent-blue-light); border-color: var(--accent-blue); color: var(--text-primary); }
.quick-access-btn img { width: 24px; height: 24px; }
.quick-access-btn span { font-weight: 600; font-size: var(--font-size-sm); white-space: nowrap; }

.tool-explanation {
    font-size: var(--font-size-sm);
    color: var(--text-secondary);
    text-align: left;
    max-width: 800px;
    margin: 0 auto var(--spacing-6);
    line-height: 1.5;
}
#calculator-main-description {
    white-space: nowrap;
}

.carousel-container { position: relative; width: 100%; margin: 0 auto; overflow: hidden; }
.carousel-track { display: flex; }
.carousel-slide { flex: 0 0 100%; padding: 0 25px; box-sizing: border-box; display: none; min-width: 0; }
.carousel-slide.is-active { display: block; }

.carousel-arrow { 
    position: absolute; 
    top: 250px;
    transform: translateY(-50%); 
    background: transparent; 
    border: none; 
    color: rgba(255, 255, 255, 0.7); 
    cursor: pointer; 
    z-index: 10; 
    font-size: 3rem; 
    padding: var(--spacing-4); 
    text-shadow: 0 0 10px rgba(0,0,0,0.5); 
    transition: color 0.3s ease, opacity 0.3s ease; 
}
.carousel-arrow:hover { color: white; }
.carousel-arrow.disabled { opacity: 0.2; cursor: default; pointer-events: none; }
.carousel-arrow.prev { left: calc(50% - 520px); }
.carousel-arrow.next { right: calc(50% - 520px); }
.calculator-island { background: rgba(20, 21, 24, 0.65); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: var(--radius-lg); padding: var(--spacing-6); width: 100%; max-width: 850px; margin: 0 auto; min-height: 550px; position: relative; }
.island-content .form-group { margin-bottom: var(--spacing-4); }
.island-content label, .island-content .form-label-heading { display: block; font-weight: 500; color: var(--text-secondary); margin-bottom: var(--spacing-2); }
.island-content input[type="number"], .island-content select { width: 100%; background: var(--bg-primary); border: 1px solid var(--border-hover); border-radius: var(--radius-sm); padding: var(--spacing-3); color: var(--text-primary); font-size: var(--font-size-base); }
.calc-result { margin-top: var(--spacing-2); padding: var(--spacing-4); background: var(--bg-secondary); border-radius: var(--radius-md); text-align: center; font-size: var(--font-size-lg); min-height: 60px; display: flex; align-items: center; justify-content: center; gap: var(--spacing-2); position: relative; flex-direction: column;}
.calc-result strong { color: var(--accent-blue-bright); font-weight: 700; }

.calc-result.result-success::after { content: ''; position: absolute; inset: 0; border-radius: inherit; border: 2px solid transparent; animation: glow-border 1.2s ease-out; }
@keyframes glow-border { 0% { border-color: transparent; box-shadow: 0 0 0 0 transparent; } 25% { border-color: var(--accent-green); box-shadow: 0 0 15px 0 var(--accent-green); } 100% { border-color: transparent; box-shadow: 0 0 15px 0 transparent; } }
.counting-blur { filter: blur(2px); opacity: 0.8; transform: translateZ(0); }
.calc-result span, .calc-result strong { transition: filter 0.4s ease-out, opacity 0.4s ease-out; }


.tool-hero { padding-bottom: var(--spacing-4); flex-grow: 1; display: flex; flex-direction: column; }

.button-selector { display: flex; gap: var(--spacing-3); }
#troop-type-selector {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
}
.selector-btn { background: var(--bg-tertiary); border: 2px solid var(--border-color); padding: var(--spacing-2) var(--spacing-4); border-radius: var(--radius-md); cursor: pointer; color: white; font-weight: 600; transition: all 0.2s ease; flex: 1; display: flex; align-items: center; justify-content: center; gap: var(--spacing-2); position: relative; }
.selector-btn:hover { border-color: rgba(255, 255, 255, 0.3); }

.selector-btn.active {
    border: 2px solid transparent;
    background-clip: padding-box, border-box;
    background-origin: padding-box, border-box;
}
.selector-btn[data-type="cavalry"].active {
    background-image: linear-gradient(var(--bg-tertiary), var(--bg-tertiary)),
                      linear-gradient(to right, #00be21, #046c04);
}
.selector-btn[data-type="infantry"].active {
    background-image: linear-gradient(var(--bg-tertiary), var(--bg-tertiary)),
                      linear-gradient(to right, #00a2d4, #006d97);
}
.selector-btn[data-type="archer"].active {
    background-image: linear-gradient(var(--bg-tertiary), var(--bg-tertiary)),
                      linear-gradient(to right, #ef4444, #b91c1c);
}
.selector-btn[data-type="engineering"].active {
    background-image: linear-gradient(var(--bg-tertiary), var(--bg-tertiary)),
                      linear-gradient(to right, #ca62e6, #8113a7);
}

.selector-btn span { text-shadow: 0 1px 2px black; }
.selector-btn.active span { color: white !important; }
.selector-btn img { height: 24px; width: auto; filter: drop-shadow(0 0 1px black); }

.selectors-container { display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-6); margin-top: var(--spacing-4); }
.pairing-selector-wrapper, .equipment-carousel-wrapper, .inscription-selector-wrapper { min-height: 0; display: flex; flex-direction: column; height: 100%; transition: opacity 0.15s ease-in-out;}
.pairing-selector { display: grid; grid-template-columns: 1fr; gap: var(--spacing-2); overflow-y: auto; padding-right: var(--spacing-2); flex-grow: 1; height: 400px;}
.pairing-item { background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: var(--spacing-2); display: flex; align-items: center; gap: var(--spacing-3); cursor: pointer; transition: all 0.2s ease; }
.pairing-item:hover { background: var(--bg-secondary); border-color: var(--border-hover); }
.pairing-item.active { background: var(--accent-blue-light); border-color: var(--accent-blue); }
.pairing-images { display: flex; align-items: center; }
.commander-icon { width: 40px; height: 40px; border-radius: 50%; border: none; }
.commander-icon.secondary { margin-left: -15px; }
.pairing-item span { font-weight: 500; font-size: calc(var(--font-size-sm) * 0.9); }

.equipment-carousel-wrapper { position: relative; }
#equipment-set-carousel { background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: var(--spacing-4); text-align: center; height: 100%; display: flex; flex-direction: column; justify-content: center; }
#equipment-display { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; transition: opacity 0.15s ease-in-out; }
#equipment-display.fade-out { opacity: 0; }
.equipment-loadout-shape { position: relative; width: 280px; height: 280px; margin: 0 auto; }
.equipment-slot { position: absolute; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; transform: rotate(45deg); }
.equipment-slot img { max-width: 50px; max-height: 50px; object-fit: contain; transform: rotate(-45deg); }
.equipment-slot[data-slot="helmet"] { top: -10px; left: 110px; }
.equipment-slot[data-slot="weapon"] { top: 110px; left: 40px; }
.equipment-slot[data-slot="chest"] { top: 60px; left: 110px; }
.equipment-slot[data-slot="gloves"] { top: 110px; left: 180px; }
.equipment-slot[data-slot="legs"] { top: 160px; left: 110px; }
.equipment-slot[data-slot="boots"] { top: 230px; left: 110px; }
.equipment-set-name { font-weight: 600; font-size: var(--font-size-base); margin-top: var(--spacing-6); }
.equipment-arrow { 
    position: absolute; 
    top: 50%; 
    transform: translateY(-50%); 
    background: rgba(0,0,0,0.3); 
    border: 1px solid var(--border-color); 
    color: white; 
    border-radius: 50%; 
    width: 30px; 
    height: 30px; 
    cursor: pointer; 
    z-index: 1; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
}
#prev-set { left: 10px; }
#next-set { right: 10px; }
#pagination-dots { display: flex; justify-content: center; gap: var(--spacing-2); margin-top: var(--spacing-3); }
.dot { width: 8px; height: 8px; background: var(--border-color); border-radius: 50%; transition: background 0.2s ease; }
.dot.active { background: var(--accent-blue); }

.stats-result-display { margin-top: var(--spacing-6); padding: var(--spacing-3); background: var(--bg-secondary); border-radius: var(--radius-md); text-align: center; }
.stats-result-display h4 { color: var(--text-secondary); margin-bottom: var(--spacing-1); font-size: var(--font-size-sm); }
.stats-result-display p { font-size: var(--font-size-base); font-weight: 500; }
.stats-result-display strong { color: var(--accent-blue-bright); }

.form-group-horizontal-power { display: grid; grid-template-columns: 1fr auto 1fr; gap: var(--spacing-4); align-items: center; margin-top: var(--spacing-6); }
.input-divider { color: var(--text-secondary); font-weight: 600; align-self: center; padding-bottom: 0; }
.calc-result .conversion-label { font-size: var(--font-size-sm); color: var(--text-secondary); text-align: center; height: auto; width: 100%; margin: 0; }

.contributor-section { padding: var(--spacing-8) var(--spacing-6) var(--spacing-16); }
.contributor-container { max-width: 1125px; margin: 0 auto; }
.contributor-box { background: linear-gradient(145deg, rgba(20, 21, 24, 0.8), rgba(30, 32, 40, 0.9)); border: 1px solid var(--border-color); border-radius: var(--radius-xl); padding: var(--spacing-6); display: flex; flex-direction: column; gap: var(--spacing-4); }
.contributor-content h3 { font-size: var(--font-size-xl); color: var(--text-primary); margin-bottom: var(--spacing-3); }
.contributor-content p { color: var(--text-secondary); line-height: 1.6; margin-bottom: var(--spacing-3); font-size: var(--font-size-xs); }
.contributor-connect { font-weight: 500; color: var(--text-primary) !important; }
.wizard-gradient { background: linear-gradient(90deg, #4cadd0, #b2f9ff); -webkit-background-clip: text; background-clip: text; color: transparent; font-weight: 700; display: inline-block; }
.contributor-actions { display: flex; flex-direction: column; gap: var(--spacing-3); padding-top: var(--spacing-3); border-top: 1px solid rgba(255, 255, 255, 0.05); }
.action-item { display: flex; align-items: center; gap: var(--spacing-3); }
.action-label { font-size: var(--font-size-sm); color: var(--text-secondary); font-weight: 500; min-width: 90px; text-align: right; }
.action-btn { display: inline-flex; align-items: center; justify-content: center; gap: var(--spacing-2); padding: var(--spacing-2) var(--spacing-4); border-radius: var(--radius-md); font-weight: 600; font-size: var(--font-size-sm); text-decoration: none; color: #FFFFFF !important; border: 1px solid rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); transition: all 0.3s ease; position: relative; overflow: hidden; z-index: 1; }
.action-btn:hover { transform: translateY(-2px); }
.discord-btn { background: rgba(88, 101, 242, 0.35); border-color: rgba(88, 101, 242, 0.7); cursor: default; }
.discord-btn:hover { background: rgba(88, 101, 242, 0.55); box-shadow: 0 0 25px rgba(88, 101, 242, 0.4); }
.discord-btn i { font-size: 1.1em; color: #FFFFFF; }
.support-btn { background: rgba(255, 221, 0, 0.35); border-color: rgba(255, 221, 0, 0.7); }
.support-btn:hover { background: rgba(255, 221, 0, 0.55); box-shadow: 0 5px 15px rgba(255, 221, 0, 0.4); }
.action-btn img { height: 20px; width: auto; }
.contributor-actions .contributor-connect { margin-bottom: var(--spacing-3); margin-top: var(--spacing-3); text-align: left; }

.inscription-search { width: 100%; background: var(--bg-primary); border: 1px solid var(--border-hover); border-radius: var(--radius-sm); padding: var(--spacing-2); color: var(--text-primary); font-size: var(--font-size-sm); margin-bottom: var(--spacing-2); }
.armaments-bottom-row { display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-6); margin-top: var(--spacing-4); }
.stat-inputs-grid { display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-4); }
.selected-inscriptions-wrapper { display: flex; flex-direction: column; min-height: 178px; background: var(--bg-primary); border: 1px solid var(--border-hover); border-radius: var(--radius-sm); padding: var(--spacing-3); }
#selected-inscriptions-display { flex-grow: 1; display: flex; align-items: center; justify-content: center; }
.formation-selector { display: grid; grid-template-columns: repeat(5, 1fr); gap: var(--spacing-2); }
.formation-btn { background: var(--bg-tertiary); border: 2px solid var(--border-color); border-radius: var(--radius-sm); padding: var(--spacing-2); cursor: pointer; transition: all 0.2s ease; display: flex; flex-direction: column; align-items: center; gap: var(--spacing-1); }
.formation-btn:hover { background: var(--bg-secondary); }
.formation-btn.active { border: 2px solid transparent; background-clip: padding-box, border-box; background-origin: padding-box, border-box; background-image: linear-gradient(var(--bg-tertiary), var(--bg-tertiary)), linear-gradient(to right, #FFD700, #FFA500); }
.formation-btn img { width: 32px; height: 32px; }
.formation-btn span { font-size: var(--font-size-xs); font-weight: 500; color: var(--text-primary); }
.inscription-selector { background: var(--bg-primary); border: 1px solid var(--border-hover); border-radius: var(--radius-sm); padding: var(--spacing-3); flex-grow: 1; overflow-y: auto; max-height: 230px;}
.inscription-grid { display: flex; flex-wrap: wrap; gap: var(--spacing-2); }
#selected-inscriptions-display .inscription-grid { justify-content: center; }
.inscription-tag {
    font-family: 'NotoSansHans';
    background: #D1D5DB;
    border: none;
    border-bottom: 2px solid #4D4D4D;
    color: #000000;
    padding: 2px 14px;
    font-size: 12px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
    opacity: 1;
    position: relative;
    clip-path: polygon(8px 0, calc(100% - 8px) 0, 100% 50%, calc(100% - 8px) 100%, 8px 100%, 0 50%);
    box-shadow: none;
}
.inscription-tag:hover { border-color: var(--accent-blue); }
.inscription-tag.special {
    background: linear-gradient(to bottom, #FFF77A, #FDD451);
    border-bottom-color: #E5A000;
    box-shadow: inset 0 -2px 0 0 #FDD451;
    color: #A34A00;
    text-shadow: 0 1px 2px rgba(255, 255, 255, 0.3);
}
.inscription-tag.rare {
    background: linear-gradient(to bottom, #C6E4FB, #ACC9FC);
    border-bottom-color: #2546da;
    box-shadow: inset 0 -2px 0 0 #D3EBFD;
    color: #2546da;;
    text-shadow: none;
}
.last-updated-note { font-size: var(--font-size-xs); color: var(--text-muted); text-align: center; margin-top: var(--spacing-4); }
.inscription-placeholder { text-align: center; color: var(--text-secondary); font-size: var(--font-size-sm); padding: var(--spacing-4) 0; }
.inscription-deselect-note {
    font-size: var(--font-size-xs);
    color: var(--text-secondary);
    text-align: center;
    margin-top: var(--spacing-2);
}

.generator-tabs { display: flex; border-bottom: 1px solid var(--border-color); margin-bottom: var(--spacing-4); }
.generator-tab-btn { padding: var(--spacing-3) var(--spacing-4); cursor: pointer; background: none; border: none; color: var(--text-secondary); font-weight: 600; position: relative; transition: color 0.2s ease; }
.generator-tab-btn:hover { color: var(--text-primary); }
.generator-tab-btn.active { color: var(--accent-blue); }
.generator-tab-btn.active::after { content: ''; position: absolute; bottom: -1px; left: 0; right: 0; height: 2px; background: var(--accent-blue); }
.generator-view { display: none; }
.generator-view.active { display: block; animation: fadeIn 0.5s ease-in-out; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

#saved-scores-view { position: relative; min-height: 600px; }
.saved-templates-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: var(--spacing-4); margin-bottom: var(--spacing-4); }
.saved-templates-header h2 { margin: 0; font-size: var(--font-size-xl); }

.save-score-section {
    margin-top: var(--spacing-4);
    padding-top: var(--spacing-4);
    border-top: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-2);
    font-size: var(--font-size-base);
    min-height: 48px;
}
.save-score-section .discord-login-btn { min-height: 44px; height: auto; }
.save-score-section .discord-login-btn span { display: inline; }

.saved-scores-grid { display: grid; grid-template-columns: 100px 100px 1.5fr 1fr 100px 80px; align-items: start; gap: var(--spacing-4); }
.saved-scores-grid .grid-header { font-weight: 600; color: var(--text-secondary); font-size: var(--font-size-sm); padding-bottom: var(--spacing-2); border-bottom: 1px solid var(--border-color); }
.saved-scores-grid .grid-row { display: contents; }
.saved-scores-grid .grid-row > div { padding: var(--spacing-3) 0; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; min-height: 85px; }
.saved-scores-grid .grid-row:last-child > div { border-bottom: none; }
.saved-scores-grid .score-inscriptions .inscription-grid { max-height: 65px; overflow-y: hidden; align-content: flex-start; }
.saved-scores-grid .score-stats { flex-direction: column; align-items: flex-start; font-size: var(--font-size-xs); line-height: 1.5; }
.saved-scores-grid .total-score { font-weight: 700; font-size: var(--font-size-lg); justify-content: center; }
.saved-scores-grid .score-actions { justify-content: center; }
.saved-scores-grid .score-actions .btn-danger { padding: 0; width: 36px; height: 36px; min-width: 0; min-height: 0; font-size: var(--font-size-sm); background-color: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.5); color: #f87171; }
.saved-scores-grid .score-actions .btn-danger:hover { background-color: rgba(239, 68, 68, 0.4); border-color: #ef4444; color: white; }

.logged-out-overlay { position: absolute; inset: 0; background: rgba(12, 12, 15, 0.8); display: flex; align-items: center; justify-content: center; text-align: center; border-radius: var(--radius-lg); z-index: 10; backdrop-filter: blur(4px); }
.logged-out-message h3 { margin-bottom: var(--spacing-6); font-size: var(--font-size-lg); color: var(--text-secondary); }

@media (max-width: 768px) {
    .carousel-slide { padding: 0 var(--spacing-8); }
    .carousel-arrow { font-size: 2rem; }
    .carousel-arrow.prev { left: -12px; }
    .carousel-arrow.next { right: -12px; }
    .quick-access-nav { overflow-x: auto; justify-content: flex-start; }
    .button-selector {
        display: grid;
        grid-auto-flow: column;
        grid-auto-columns: 1fr;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
    }
    .davor-byline .davor-title-icon {
        height: 50px;
    }
    #troop-type-selector {
        grid-auto-flow: row;
        overflow-x: initial;
        grid-auto-columns: initial;
    }
    
    .button-selector::-webkit-scrollbar {
        display: none;
    }
    #calculator-main-description { white-space: normal; }
    .tool-title { flex-direction: column; gap: var(--spacing-2); }
    .selectors-container { grid-template-columns: 1fr; min-height: auto; height: auto; }
    .pairing-selector { max-height: 280px; height: auto; }
    .pairing-item span { font-size: calc(var(--font-size-sm) * 0.9); }
    .equipment-arrow { top: 90%; font-size: 1.5rem; }
    #prev-set { left: calc(35% - 95px); }
    #next-set { right: calc(35% - 95px); }
    .contributor-box { padding: var(--spacing-6); }
    .stats-result-display h4, .calc-result .conversion-label { font-size: var(--font-size-sm); }
    .action-item { flex-direction: column; align-items: flex-start; gap: var(--spacing-2); }
    .action-label { text-align: left; min-width: auto; }
    .action-btn { width: 100%; justify-content: center; }
    .armaments-bottom-row { 
        display: flex;
        flex-direction: column;
    }
    .selected-inscriptions-wrapper {
        order: 1;
    }
    .stat-inputs-grid {
        order: 2;
    }
    .formation-selector {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
    }
    .formation-selector .formation-btn:nth-child(-n+2) {
        grid-column: span 3;
    }
    .formation-selector .formation-btn:nth-child(n+3) {
        grid-column: span 2;
    }
    .inscription-selector { height: 200px; max-height: 200px; }
    #calculator-main-title {
        flex-direction: column;
        gap: var(--spacing-2);
    }
    .davor-byline {
        display: flex;
        align-items: center;
        gap: var(--spacing-2);
        font-size: var(--font-size-base);
        font-weight: 500;
    }
    .saved-scores-grid {
        display: flex;
        flex-direction: column;
        gap: 0;
    }
    .saved-scores-grid .grid-header { display: none; }
    .saved-scores-grid .grid-row > div {
        border-bottom: none;
        padding: var(--spacing-1) 0;
        min-height: 0;
        width: 100%;
    }
    .saved-scores-grid .grid-row-container {
        display: flex;
        flex-direction: column;
        padding: var(--spacing-4) 0;
        border-bottom: 1px solid var(--border-color);
        gap: var(--spacing-2);
    }
    .saved-scores-grid .score-pairing { order: 1; }
    .saved-scores-grid .score-formation { order: 2; }
    .saved-scores-grid .total-score { order: 3; justify-content: flex-start; }
    .saved-scores-grid .score-stats { order: 4; }
    .saved-scores-grid .score-inscriptions { order: 5; }
    .saved-scores-grid .score-actions { order: 6; justify-content: flex-end; }
}

.island-content input[type="number"]::-webkit-outer-spin-button,
.island-content input[type="number"]::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

.island-content input[type="number"] {
  -moz-appearance: textfield;
  appearance: textfield;
}

#pairing-selector,
#armament-pairing-selector, 
#result-display, 
#conversion-result,
#inscription-selector {
    transition: opacity 0.15s ease-in-out;
}

.fade-out {
    opacity: 0;
}